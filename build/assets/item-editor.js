//# sourceMappingURL=item-editor.js.map
var ItemEditor=function(){this.menus=[];this.meals=[];this.edits=[];this.errors=[];this.options=[];this.menu={id:null,localId:Utils.genUUID(),name:"",meal:null,menuSections:[]};this.sectionTypes={breakfast:"Breakfast Items","sandwiches-salads":"Salads & Sandwiches",beverages:"Beverages",snacks:"Snacks"}};
ItemEditor.prototype.refreshMenus=function(){return new Promise(function(a,b){$.ajax({url:"/admin/api/menus/",type:"GET",contentType:"application/json",success:function(b){this.menus=b;a()}.bind(this),error:function(a){b(a)}.bind(this)})}.bind(this))};
ItemEditor.prototype.refreshMenu=function(a){return Promise.all([new Promise(function(b,a){$.ajax({url:"/admin/api/menu-item-options/",type:"GET",contentType:"application/json",success:function(a){this.options=a;b()}.bind(this),error:function(b){a(b)}.bind(this)})}.bind(this)),new Promise(function(b,a){$.ajax({url:"/admin/api/meals/",type:"GET",contentType:"application/json",success:function(a){this.meals=a;b()}.bind(this),error:function(b){a(b)}.bind(this)})}.bind(this)),new Promise(function(b,c){a?
$.ajax({url:"/admin/api/menus/"+a,type:"GET",contentType:"application/json",success:function(a){this.menu=a;b()}.bind(this),error:function(a){c(a)}.bind(this)}):b()}.bind(this))])};ItemEditor.prototype.deleteMenu=function(a){a.deleted=!0;this.saveMenu(a)};
ItemEditor.prototype.saveMenu=function(a){if(this.validateMenu(a))return new Promise(function(b,c){$.ajax({url:"/admin/api/menus/save",type:"POST",contentType:"application/json",data:JSON.stringify(a),success:function(a){window.location="/admin/menus"}.bind(this),error:function(a){c()}.bind(this)})}.bind(this));this.buildMenuForm(a)};
ItemEditor.prototype.validateMenu=function(a){a=a||this.menu;if(""==$.trim(a.name))this.errors.name="Menu name is required";else{delete this.errors.name;var b=document.querySelector(".errors.name");b&&b.parentNode.removeChild(b)}a.meal?(delete this.errors.meal,(b=document.querySelector(".errors.meal"))&&b.parentNode.removeChild(b)):this.errors.meal="A meal selection is required";return 0===Object.keys(this.errors).length};
ItemEditor.prototype.updateMenu=function(a,b){if("name"===a&&0<b.target.value.length){delete this.errors.name;var c=document.querySelector(".errors.name");c&&c.parentNode.removeChild(c)}this.menu[a]=b.target.value};ItemEditor.prototype.updateMeal=function(a){var b=this.meals.filter(function(b){return b.id===parseInt(a.target.value,10)})[0];b&&(this.menu.meal=b,delete this.errors.meal,(b=document.querySelector(".errors.meal"))&&b.parentNode.removeChild(b))};
ItemEditor.prototype.submitForm=function(a){a.stopPropagation();a.preventDefault();this.saveMenu(this.menu)};ItemEditor.prototype.initMove=function(a,b,c){Utils.initMove("section","menu-item",a.id||a.localId,b.id||b.localId,this.reorder.bind(this,a),c)};ItemEditor.prototype.openEditMenuItem=function(a,b){this.edits.push(b.id||b.localId);this.buildMenuSection(a.name,!0);document.querySelector(".menu-item-"+(b.id||b.localId)+" input").select()};
ItemEditor.prototype.editMenuItem=function(a,b){var c=document.querySelector(".menu-item-"+b.id+" input");c&&(b.name=c.value,this.edits.splice(this.edits.indexOf(b.id||b.localId),1),this.buildMenuSection(a.name,!0))};ItemEditor.prototype.cancelEditMenuItem=function(a,b){this.edits.splice(this.edits.indexOf(b.id||b.localId),1);this.buildMenuSection(a.name,!0)};
ItemEditor.prototype.toggleGroup=function(a,b,c,d){(d=(b.menuItemOptionGroups||[]).filter(function(a){return a.id===c.id})[0])?b.menuItemOptionGroups.splice(b.menuItemOptionGroups.indexOf(d),1):b.menuItemOptionGroups.push(c);this.buildMenuSection(a.name,!0)};ItemEditor.prototype.hasGroup=function(a,b){return!!a.menuItemOptionGroups&&!!a.menuItemOptionGroups.filter(function(a){return a.id===b.id})[0]};
ItemEditor.prototype.rebuildOrdering=function(a){var b=document.querySelectorAll(".section-"+(a.id||a.localId)+" .menu-item");if(a){for(var b=Array.prototype.map.call(b,function(a){return isNaN(a.dataset.id,10)?a.dataset.id:parseInt(a.dataset.id,10)}),c=0;c<(a.menuItems||[]).length;c++){var d=a.menuItems[c];d.position=b.indexOf(d.id||d.localId)}a.ordering=b.join(",")}};ItemEditor.prototype.reorder=function(a){a&&this.rebuildOrdering(a)};
ItemEditor.prototype.removeMenuItem=function(a,b){var c=a.ordering.split(",");c.indexOf(b.id+""||b.localId);a.menuItems.splice(a.menuItems.indexOf(b),1);a.ordering=c.join(",");this.buildMenuSection(a.name,!0)};ItemEditor.prototype.addItem=function(a){var b=document.querySelector(".section-"+(a.id||a.localId)+" .add-item-input").value,b={id:null,localId:Utils.genUUID(),name:b,position:a.menuItems.length,menuItemOptionGroups:[]};a.menuItems.push(b);this.buildMenuSection(a.name,!0)};
ItemEditor.prototype.buildMenuSection=function(a,b){var c=this.menu.menuSections.filter(function(b){return b.name===a})[0],d=this.sectionTypes[a];c||(c={id:null,localId:Utils.genUUID(),name:a,position:["breakfast","sandwiches-salads","beverages","snacks"].indexOf(a),ordering:"",menuItems:[]},this.menu.menuSections.push(c));d={tag:"li",attributes:{className:"sortable-list section section-"+(c.id||c.localId),dataId:c.id||c.localId},children:[{tag:"h2",attributes:{text:d}},{tag:"ul",attributes:{className:"sortable-list-items menu-items menu-list"},
condition:function(a){return 0<a.menuItems.length}.bind(this,c),children:c.menuItems.sort(function(a,b){return a.position>b.position}).map(function(a){return a?{tag:"li",attributes:{className:(-1===this.edits.indexOf(a.id||a.localId)?"":"editing")+" sortable-list-item menu-item menu-item-"+(a.id||a.localId),dataId:a.id||a.localId},children:[{tag:"i",attributes:{className:"fa fa-arrows move",onMouseDown:this.initMove.bind(this,c,a)},children:[]},{tag:"div",attributes:{className:"menu-item-name",text:a.name},
children:[]},{tag:"div",attributes:{className:"item-editor"},children:[{tag:"input",attributes:{className:"item-edit",type:"text",value:a.name}},{tag:"div",attributes:{className:"item-edit-controls"},children:[{tag:"i",attributes:{className:"fa fa-check confirm",onClick:this.editMenuItem.bind(this,c,a)}},{tag:"i",attributes:{className:"fa fa-times cancel",onClick:this.cancelEditMenuItem.bind(this,c,a)}}]}]},{tag:"div",attributes:{className:"actions"},children:[{tag:"i",attributes:{className:"fa fa-edit edit",
onClick:this.openEditMenuItem.bind(this,c,a)},children:[]},{tag:"i",attributes:{className:"fa fa-trash-o remove",onClick:this.removeMenuItem.bind(this,c,a),children:[]}}]},{tag:"div",attributes:{className:"menu-item-options"},children:this.options.map(function(b){return{tag:"div",attributes:{className:(this.hasGroup(a,b)?"active ":"")+"icon icon-"+b.name.toLowerCase().replace(" ","-"),onClick:this.toggleGroup.bind(this,c,a,b)}}}.bind(this))}]}:null}.bind(this)).filter(function(a){return!!a}.bind(this))},
{tag:"div",attributes:{className:"add-item-wrapper"},children:[{tag:"div",attributes:{className:"input-wrapper"},children:[{tag:"input",attributes:{className:"add-item-input",type:"text",placeholder:"Item name"},children:[]}]},{tag:"div",attributes:{className:"input-wrapper"},children:[{tag:"input",attributes:{className:"add-item-btn btn",value:"Add",type:"button",onClick:this.addItem.bind(this,c)}}]}]}]};if(b){b=document.querySelector(".sections");var e=b.querySelector(".section-"+(c.id||c.localId)),
d=Utils.buildHTML(d);null!==e?(e.parentNode.insertBefore(d,e),e.parentNode.removeChild(e)):b.appendChild(d)}else return d};
ItemEditor.prototype.buildMenuForm=function(a){var b=document.querySelector(".menus"),c=document.querySelector(".menus form"),d={tag:"form",attributes:{class:"menu-form",onSubmit:this.submitForm.bind(this)},children:[{tag:"div",attributes:{className:"input-wrapper name"},children:[{tag:"h2",attributes:{text:"Menu Name"}},{tag:"ul",attributes:{className:"errors name"},condition:function(){return void 0!==this.errors.name}.bind(this),children:[{tag:"li",attributes:{text:this.errors.name}}]},{tag:"input",
attributes:{type:"text",value:a.name||"",onChange:this.updateMenu.bind(this,"name")}},{tag:"p",attributes:{text:"Leave sections empty to hide it on the menu."}}]},{tag:"fieldset",attributes:{},children:[{tag:"legend",attributes:{text:"Meal"}},{tag:"p",attributes:{text:"Select a meal plan for this menu."}},{tag:"ul",attributes:{className:"errors meal"},condition:function(){return void 0!==this.errors.meal}.bind(this),children:[{tag:"li",attributes:{text:this.errors.meal}}]},{tag:"div",attributes:{className:"options"},
children:this.meals.map(function(b,c){return{tag:"div",attributes:{className:"input-wrapper radio"},children:[{tag:"input",attributes:{type:"radio",name:"meal",checked:a.meal&&a.meal.id===b.id,value:b.id,id:"meal-"+c,onChange:this.updateMeal.bind(this)}},{tag:"label",attributes:{className:"btn",text:b.name,"for":"meal-"+c}}]}}.bind(this))}]},{tag:"ul",attributes:{className:"sortable-lists sections"},children:Object.keys(this.sectionTypes).map(function(a){return this.buildMenuSection(a,!1)}.bind(this))},
{tag:"div",attributes:{className:"btns"},children:[{tag:"input",attributes:{className:"btn submit confirm",type:"submit"},children:[]},{tag:"a",attributes:{className:"btn cancel",href:"/admin/menus",text:"Cancel"},children:[]}]}]},d=Utils.buildHTML(d);null!==c?(c.parentNode.insertBefore(d,c),c.parentNode.removeChild(c)):b.appendChild(d)};
ItemEditor.prototype.buildMenus=function(){for(var a=0;a<this.menus.length;a++){var b=this.menus[a],c=document.querySelector(".menus"),d=document.querySelector(".menus-"+b.id),b={tag:"li",attributes:{className:"info-list menu-"+b.id},children:[{tag:"div",attributes:{className:"info name",text:b.name},children:[]},{tag:"div",attributes:{className:"action"},children:[{tag:"a",attributes:{href:"/admin/menus/"+b.id},children:[{tag:"i",attributes:{className:"fa fa-edit"},children:[]}]}]},{tag:"div",attributes:{className:"action"},
children:[{tag:"i",attributes:{className:"fa fa-trash-o",onClick:Utils.confirm.bind(Utils,"Are you sure you want to delete this Menu?",this.deleteMenu.bind(this,b))},children:[]}]}]},b=Utils.buildHTML(b);null!==d?(d.parentNode.insertBefore(b,d),d.parentNode.removeChild(d)):c.appendChild(b)}};