//# sourceMappingURL=location-editor.js.map
var LocationEditor=function(){this.locations=[];this.location={menus:[]};this.menus=[];this.errors={}};LocationEditor.prototype.refreshMenus=function(){return new Promise(function(a,c){$.ajax({url:"/admin/api/menus",type:"GET",contentType:"application/json",success:function(b){this.menus=b;a()}.bind(this),error:function(a){console.warn(a);c(a)}.bind(this)})}.bind(this))};
LocationEditor.prototype.refreshLocations=function(){return new Promise(function(a,c){$.ajax({url:"/admin/api/locations",type:"GET",contentType:"application/json",success:function(b){this.locations=b;a()}.bind(this),error:function(a){console.warn(a);c(a)}.bind(this)})}.bind(this))};
LocationEditor.prototype.getLocation=function(a){return new Promise(function(c,b){$.ajax({url:"/admin/api/locations/"+a,type:"GET",contentType:"application/json",success:function(a){this.location=a;c()}.bind(this),error:function(a){console.warn(a);b(a)}.bind(this)})}.bind(this))};
LocationEditor.prototype.saveLocation=function(a){a.stopPropagation();a.preventDefault();if(this.validateLocation())return new Promise(function(a,b){$.ajax({url:"/admin/api/locations/save",type:"POST",contentType:"application/json",data:JSON.stringify(this.location),success:function(a){window.location="/admin/locations"}.bind(this),error:function(a){console.warn(a);b(a)}.bind(this)})}.bind(this));this.buildLocationForm(this.location)};
LocationEditor.prototype.deleteLocation=function(a){$.ajax({url:"/admin/api/locations/"+a.id+"/delete",type:"DELETE",success:function(a){window.location.reload()}.bind(this),error:function(a){console.log(a)}.bind(this)})};
LocationEditor.prototype.validateLocation=function(){if(""==$.trim(this.location.name))this.errors.name="Location name is required";else{delete this.errors.name;var a=document.querySelector(".errors.name");a&&a.parentNode.removeChild(a)}""==$.trim(this.location.openingDate)?this.errors.openingDate="A valid start date is required":this.location.openingDate.isValid()?(delete this.errors.openingDate,(a=document.querySelector(".errors.openingDate"))&&a.parentNode.removeChild(a)):this.errors.openingDate=
"A valid start date is required";""==$.trim(this.location.closingDate)?this.errors.closingDate="A valid end date is required":this.location.closingDate.isValid()?(delete this.errors.closingDate,(a=document.querySelector(".errors.closingDate"))&&a.parentNode.removeChild(a)):this.errors.closingDate="A valid end date is required";return 0===Object.keys(this.errors).length};
LocationEditor.prototype.updateLocation=function(a,c){if("openingDate"===a||"closingDate"===a){this.location[a]=moment(c.target.value,"YYYY-MM-DD");delete this.errors[a];var b=document.querySelector(".errors."+a);null!==b&&b.parentNode.removeChild(b)}else"status"===a?this.location[a]=!!c.target.value:("name"===a&&0<c.target.value.length&&(delete this.errors.name,b=document.querySelector(".errors.name"),null!==b&&b.parentNode.removeChild(b)),this.location[a]=c.target.value)};
LocationEditor.prototype.hasMenu=function(a){for(var c=this.location.menus||[],b=0;b<c.length;b++)if(c[b].id===a.id)return!0;return!1};LocationEditor.prototype.getSimilarMenu=function(a){for(var c=this.location.menus||[],b=0;b<c.length;b++)if(a.meal&&c[b].meal&&a.meal.name===c[b].meal.name)return c[b];return null};
LocationEditor.prototype.toggleMenu=function(a){var c=this.getSimilarMenu(a);null!==c&&this.location.menus.splice(this.location.menus.indexOf(c),1);c&&c.id===a.id||this.location.menus.push(a);this.buildLocationForm(this.location)};
LocationEditor.prototype.buildLocationForm=function(a){a=a||{};var c=document.querySelector(".location-form-wrapper"),b=document.querySelector(".location-form-wrapper form"),d={tag:"form",attributes:{className:"location-form",noValidate:!0,onSubmit:this.saveLocation.bind(this)},children:[{tag:"input",attributes:{type:"hidden",name:"id",value:a.id||0}},{tag:"div",attributes:{className:"input-wrapper huid"},children:[{tag:"label",attributes:{text:"Location Name"}},{tag:"ul",attributes:{className:"errors name"},
condition:function(){return void 0!==this.errors.name}.bind(this),children:[{tag:"li",attributes:{text:this.errors.name}}]},{tag:"input",attributes:{type:"text",name:"name",value:a.name||"",onChange:this.updateLocation.bind(this,"name")}}]},{tag:"div",attributes:{className:"input-wrapper opening-date"},children:[{tag:"label",attributes:{text:"Semester Start"}},{tag:"ul",attributes:{className:"errors openingDate"},condition:function(){return void 0!==this.errors.openingDate}.bind(this),children:[{tag:"li",
attributes:{text:this.errors.openingDate}}]},{tag:"input",attributes:{type:"date",name:"openingDate",value:a.openingDate?moment(a.openingDate).format("YYYY-MM-DD"):"",onChange:this.updateLocation.bind(this,"openingDate")}}]},{tag:"div",attributes:{className:"input-wrapper closing-date"},children:[{tag:"label",attributes:{text:"Semester End"}},{tag:"ul",attributes:{className:"errors closingDate"},condition:function(){return void 0!==this.errors.closingDate}.bind(this),children:[{tag:"li",attributes:{text:this.errors.closingDate}}]},
{tag:"input",attributes:{type:"date",type:"date",name:"closingDate",value:a.closingDate?moment(a.closingDate).format("YYYY-MM-DD"):"",onChange:this.updateLocation.bind(this,"closingDate")}}]},{tag:"fieldset",attributes:{className:"status"},children:[{tag:"legend",attributes:{text:"Status"}},{tag:"div",attributes:{className:"options"},children:[!0,!1].map(function(b){var c=b?"Active":"Inactive",d=+b;return{tag:"div",attributes:{className:"input-wrapper radio"},children:[{tag:"input",attributes:{type:"radio",
checked:a.status===b||void 0===a.status&&1===d,name:"status",value:d,id:"active-"+d,onChange:this.updateLocation.bind(this,"status")}},{tag:"label",attributes:{className:"btn",text:c,"for":"status-"+d}}]}}.bind(this))}]},{tag:"fieldset",attributes:{className:"breakfast"},children:[{tag:"legend",attributes:{text:"Breakfast"}},{tag:"div",attributes:{className:"options"},children:this.menus.filter(function(a){return!!a.meal&&"Breakfast"===a.meal.name}).map(function(a){return{tag:"div",attributes:{className:"input-wrapper checkbox"},
children:[{tag:"input",attributes:{type:"checkbox",checked:this.hasMenu(a),name:"breakfast",value:a.id,id:"breakfast-"+a.id,onChange:this.toggleMenu.bind(this,a)}},{tag:"label",attributes:{className:"btn",text:a.name,"for":"menu-"+a.id}}]}}.bind(this))}]},{tag:"fieldset",attributes:{className:"breakfast"},children:[{tag:"legend",attributes:{text:"Lunch"}},{tag:"div",attributes:{className:"options"},children:this.menus.filter(function(a){return!!a.meal&&"Lunch"===a.meal.name}).map(function(a){return{tag:"div",
attributes:{className:"input-wrapper checkbox"},children:[{tag:"input",attributes:{type:"checkbox",checked:this.hasMenu(a),name:"lunch",value:a.id,id:"lunch-"+a.id,onChange:this.toggleMenu.bind(this,a)}},{tag:"label",attributes:{className:"btn",text:a.name,"for":"menu-"+a.id}}]}}.bind(this))}]},{tag:"fieldset",attributes:{className:"breakfast"},children:[{tag:"legend",attributes:{text:"Dinner"}},{tag:"div",attributes:{className:"options"},children:this.menus.filter(function(a){return!!a.meal&&"Dinner"===
a.meal.name}).map(function(a){return{tag:"div",attributes:{className:"input-wrapper checkbox"},children:[{tag:"input",attributes:{type:"checkbox",checked:this.hasMenu(a),name:"dinner",value:a.id,id:"dinner-"+a.id,onChange:this.toggleMenu.bind(this,a)}},{tag:"label",attributes:{className:"btn",text:a.name,"for":"menu-"+a.id}}]}}.bind(this))}]},{tag:"div",attributes:{className:"btns"},children:[{tag:"input",attributes:{className:"btn submit confirm",type:"submit",value:this.location.id?"Save":"Add"},
children:[]},{tag:"a",attributes:{className:"btn cancel",href:"/admin/locations",text:"Cancel"},children:[]}]}]},d=Utils.buildHTML(d);null!==b?(b.parentNode.insertBefore(d,b),b.parentNode.removeChild(b)):c.appendChild(d)};
LocationEditor.prototype.buildLocation=function(a){var c=document.querySelector(".locations"),b=document.querySelector(".location-"+a.id);a={tag:"li",attributes:{className:"info-list location-"+a.id},children:[{tag:"div",attributes:{className:"info name",text:a.name},children:[]},{tag:"div",attributes:{className:"info openingDate",text:moment(a.openingDate).format("MM/DD/YYYY")},children:[]},{tag:"div",attributes:{className:"info closingDate",text:moment(a.closingDate).format("MM/DD/YYYY")},children:[]},
{tag:"div",attributes:{className:"info menu",text:(a.menus||[]).map(function(a){return a.name}).join(", ")||"Edit to Add Menus"},children:[]},{tag:"div",attributes:{className:"info status",text:a.status?"Active":"Inactive"},children:[]},{tag:"div",attributes:{className:"action"},children:[{tag:"a",attributes:{href:"/admin/locations/"+a.id},children:[{tag:"i",attributes:{className:"fa fa-edit"},children:[]}]}]},{tag:"div",attributes:{className:"action"},children:[{tag:"a",attributes:{onClick:Utils.confirm.bind(Utils,
"Are you sure you want to delete this Location?",this.deleteLocation.bind(this,a))},children:[{tag:"i",attributes:{className:"fa fa-trash-o"},children:[]}]}]}]};a=Utils.buildHTML(a);null!==b?(b.parentNode.insertBefore(a,b),b.parentNode.removeChild(b)):c.appendChild(a)};LocationEditor.prototype.buildLocations=function(){for(var a=0;a<this.locations.length;a++)this.buildLocation(this.locations[a])};