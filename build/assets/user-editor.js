//# sourceMappingURL=user-editor.js.map
var UserEditor=function(){this.users=[];this.user={diningHalls:[]};this.errors={};this.diningHalls=[];this.filters={page:0}};UserEditor.prototype.getLocations=function(){return new Promise(function(a,b){$.ajax({url:"/admin/api/locations",type:"GET",contentType:"application/json",success:function(b){this.diningHalls=b;a()}.bind(this),error:function(a){console.warn(a);b()}.bind(this)})}.bind(this))};
UserEditor.prototype.getUsers=function(){return new Promise(function(a,b){$.ajax({url:"/admin/api/users?"+$.param(this.filters),type:"GET",contentType:"application/json",success:function(b){this.users=b;a()}.bind(this),error:function(a){console.warn(a);b()}.bind(this)})}.bind(this))};
UserEditor.prototype.getUser=function(a){return new Promise(function(b,c){$.ajax({url:"/admin/api/users/"+a,type:"GET",contentType:"application/json",success:function(a){this.user=a;b()}.bind(this),error:function(a){console.warn(a);c()}.bind(this)})}.bind(this))};
UserEditor.prototype.saveUser=function(a){a.stopPropagation();a.preventDefault();if(this.validateUser())return new Promise(function(a,c){$.ajax({url:"/admin/api/users/save",type:"POST",contentType:"application/json",data:JSON.stringify(this.user),success:function(a){window.location="/admin/users"}.bind(this),error:function(a){console.warn(a);c()}.bind(this)})}.bind(this));this.buildUserForm(this.user)};
UserEditor.prototype.deleteUser=function(a){$.ajax({url:"/admin/api/users/"+a.id+"/delete",type:"DELETE",success:function(a){window.location.reload()}.bind(this),error:function(a){console.log(a)}.bind(this)})};
UserEditor.prototype.validateUser=function(){["huid","firstName","lastName","email","userType"].map(function(a){""==$.trim(this.user[a])?this.errors[a]=a.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()})+" is required":(delete this.errors[a],(a=document.querySelector(".errors."+a))&&a.parentNode.removeChild(a))}.bind(this));return 0===Object.keys(this.errors).length};
UserEditor.prototype.updateUser=function(a,b){"active"===a||"blocked"===a?this.user[a]=!!parseInt(b.target.value,10):(this.user[a]=b.target.value,"userType"===a&&this.buildUserForm(this.user));document.querySelector("#"+b.target.id).focus()};UserEditor.prototype.filter=function(a,b){""==b?delete this.filters[a]:this.filters[a]=b;this.getUsers().then(function(){var a=document.querySelector(".users");null!==a&&(a.innerHTML="");this.buildUsers()}.bind(this))};
UserEditor.prototype.toggleLocation=function(a,b){var c=this.user.diningHalls.filter(function(b){return+b.id===+a.id})[0];"manager"===this.user.userType?c?this.user.diningHalls.splice(this.user.diningHalls.indexOf(c),1):this.user.diningHalls.push(a):"off-campus"===this.user.userType&&(this.user.diningHalls=[a]);this.buildUserForm(this.user);document.querySelector("#"+b.target.id).focus()};UserEditor.prototype.hasLoc=function(a){return!!this.user.diningHalls.filter(function(b){return b.id===a.id})[0]};
UserEditor.prototype.buildUserForm=function(a){a=a||{};var b=document.querySelector(".user-form-wrapper"),c=document.querySelector(".user-form-wrapper form"),d={"on-campus":"Student (On Campus)","off-campus":"Student (Off Campus)",manager:"Manager",admin:"Administrator"},e={tag:"form",attributes:{className:"user-form",onSubmit:this.saveUser.bind(this)},children:[{tag:"input",attributes:{type:"hidden",value:a.id||0}},{tag:"fieldset",attributes:{},children:[{tag:"legend",attributes:{text:"User Type"}},
{tag:"ul",attributes:{className:"errors userType"},condition:function(){return void 0!==this.errors.userType}.bind(this),children:[{tag:"li",attributes:{text:this.errors.userType}}]},{tag:"div",attributes:{className:"options"},children:["on-campus","off-campus","manager","admin"].map(function(b){return{tag:"div",attributes:{className:"input-wrapper radio"},children:[{tag:"input",attributes:{type:"radio",checked:b===a.userType,name:"user-type",value:b,id:"user-type-"+b,onChange:this.updateUser.bind(this,
"userType")}},{tag:"label",attributes:{className:"btn",text:d[b],"for":"user-type-1"}}]}}.bind(this))}]},{tag:"div",attributes:{className:"input-wrapper huid"},children:[{tag:"label",attributes:{text:"HUID"}},{tag:"ul",attributes:{className:"errors huid"},condition:function(){return void 0!==this.errors.huid}.bind(this),children:[{tag:"li",attributes:{text:this.errors.huid}}]},{tag:"input",attributes:{type:"text",id:"huid",name:"huid",value:a.huid||"",onChange:this.updateUser.bind(this,"huid")}}]},
{tag:"div",attributes:{className:"input-wrapper first-name"},children:[{tag:"label",attributes:{text:"First Name"}},{tag:"ul",attributes:{className:"errors firstName"},condition:function(){return void 0!==this.errors.firstName}.bind(this),children:[{tag:"li",attributes:{text:this.errors.firstName}}]},{tag:"input",attributes:{type:"text",id:"firstName",value:a.firstName||"",onChange:this.updateUser.bind(this,"firstName")}}]},{tag:"div",attributes:{className:"input-wrapper last-name"},children:[{tag:"label",
attributes:{text:"Last Name"}},{tag:"ul",attributes:{className:"errors lastName"},condition:function(){return void 0!==this.errors.lastName}.bind(this),children:[{tag:"li",attributes:{text:this.errors.lastName}}]},{tag:"input",attributes:{type:"text",id:"lastName",value:a.lastName||"",onChange:this.updateUser.bind(this,"lastName")}}]},{tag:"div",attributes:{className:"input-wrapper email"},children:[{tag:"label",attributes:{text:"Email"}},{tag:"ul",attributes:{className:"errors email"},condition:function(){return void 0!==
this.errors.email}.bind(this),children:[{tag:"li",attributes:{text:this.errors.email}}]},{tag:"input",attributes:{type:"text",id:"email",value:a.email||"",onChange:this.updateUser.bind(this,"email")}}]},{tag:"fieldset",attributes:{},children:[{tag:"legend",attributes:{text:"Block User"}},{tag:"div",attributes:{id:"blocked",className:"options"},children:[!0,!1].map(function(a){var b=a?"Yes":"No",c=+a;return{tag:"div",attributes:{className:"input-wrapper radio"},children:[{tag:"input",attributes:{type:"radio",
checked:a===this.user.blocked,name:"blocked",value:c,id:"blocked-"+c,onChange:this.updateUser.bind(this,"blocked")}},{tag:"label",attributes:{className:"btn",text:b,"for":"blocked-"+c}}]}}.bind(this))}]},{tag:"fieldset",attributes:{},condition:function(a){return"manager"===a.userType}.bind(this,a),children:[{tag:"legend",attributes:{text:"diningHalls"}},{tag:"div",attributes:{className:"options"},children:this.diningHalls.map(function(a){return{tag:"div",attributes:{className:"input-wrapper checkbox"},
children:[{tag:"input",attributes:{id:"location-"+a.id,type:"checkbox",checked:this.hasLoc(a),name:"locations",value:a.id,id:"loc-"+a.id,onChange:this.toggleLocation.bind(this,a)}},{tag:"label",attributes:{className:"btn",text:a.name,"for":"loc-"+a.id}}]}}.bind(this))}]},{tag:"fieldset",attributes:{},condition:function(a){return"off-campus"===a.userType}.bind(this,a),children:[{tag:"legend",attributes:{text:"diningHalls"}},{tag:"div",attributes:{className:"options"},children:this.diningHalls.map(function(a){return{tag:"div",
attributes:{className:"input-wrapper radio"},children:[{tag:"input",attributes:{id:"location-"+a.id,type:"radio",checked:this.hasLoc(a),name:"locations",value:a.id,id:"loc-"+a.id,onChange:this.toggleLocation.bind(this,a)}},{tag:"label",attributes:{className:"btn",text:a.name,"for":"loc-"+a.id}}]}}.bind(this))}]},{tag:"div",attributes:{className:"btns"},children:[{tag:"input",attributes:{className:"btn submit confirm",type:"submit"},children:[]},{tag:"a",attributes:{className:"btn cancel",href:"/admin/users",
text:"Cancel"},children:[]}]}]},e=Utils.buildHTML(e);null!==c?(c.parentNode.insertBefore(e,c),c.parentNode.removeChild(c)):b.appendChild(e)};
UserEditor.prototype.buildUsers=function(a){for(var b=0;b<this.users.length;b++){a=this.users[b];var c=document.querySelector(".users"),d=document.querySelector(".user-"+a.id);a={tag:"li",attributes:{className:"info-list user user-"+a.id},children:[{tag:"div",attributes:{className:"user-info huid",text:a.huid},children:[]},{tag:"div",attributes:{className:"user-info name",text:a.lastName+", "+a.firstName},children:[]},{tag:"div",attributes:{className:"user-info userType",text:a.userType},children:[]},
{tag:"div",attributes:{className:"user-info blocked",text:a.blocked?"Blocked":"Unblocked"},children:[]},{tag:"div",attributes:{className:"action"},children:[{tag:"a",attributes:{href:"/admin/users/"+a.id},children:[{tag:"i",attributes:{className:"fa fa-edit"},children:[]}]}]},{tag:"div",attributes:{className:"action"},children:[{tag:"a",attributes:{onClick:Utils.confirm.bind(Utils,"Are you sure you want to delete this User?",this.deleteUser.bind(this,a))},children:[{tag:"i",attributes:{className:"fa fa-trash-o"},
children:[]}]}]}]};a=Utils.buildHTML(a);null!==d?(d.parentNode.insertBefore(a,d),d.parentNode.removeChild(d)):c.appendChild(a)}};